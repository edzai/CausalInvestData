---
title: "Heterogeneous Treatment Effects (HTE)"
output: rmarkdown::html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(dplyr)
library(ggplot2)
```

## 🔍 Understanding Heterogeneous Treatment Effects (HTE)

HTE refers to variation in treatment effects across individuals or subgroups. Capturing this variation is key for personalized policy, targeting, and fairness in decision-making.

---

## 1. 🧪 Simulate HTE Data

```{r}
set.seed(123)
n <- 1000
X1 <- rnorm(n)
X2 <- rbinom(n, 1, 0.5)
tau <- 1 + 0.5 * X1 - 0.5 * X2  # treatment effect varies by X1 and X2
W <- rbinom(n, 1, 0.5)
Y <- tau * W + X1 + X2 + rnorm(n)

df <- data.frame(X1, X2, W, Y, tau)
```

---

## 2. 📊 Visualize True vs. Observed Effects

```{r}
group_summary <- df %>%
  group_by(X2) %>%
  summarise(treated = mean(Y[W == 1]),
            control = mean(Y[W == 0]),
            estimated_effect = treated - control)

ggplot(group_summary, aes(x = factor(X2), y = estimated_effect)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Estimated Effects by Subgroup (X2)",
       x = "X2 Subgroup", y = "Estimated Effect") +
  theme_minimal()
```

---

## ✅ Summary

- HTE models allow tailoring interventions
- Naive subgroup analysis can lead to bias
- Use methods like **causal forests** or **DML** for robust HTE estimation

---

## 📖 References

- Athey & Imbens (2016). *Recursive Partitioning for Heterogeneous Causal Effects*
- Hahn et al. (2020). *Bayesian Causal Forests*