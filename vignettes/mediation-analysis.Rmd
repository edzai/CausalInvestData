---
title: "Mediation Analysis: Understanding Indirect Effects"
output: rmarkdown::html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(dplyr)
library(ggplot2)
library(mediation)
```

## 🔄 Mediation Analysis

Mediation analysis decomposes a treatment's effect into:
- **Direct Effect**: The effect of treatment not through the mediator
- **Indirect Effect**: The effect of treatment through a mediator variable

---

## 1. 🧪 Simulate Mediated Effects

```{r}
set.seed(123)
n <- 1000

X <- rbinom(n, 1, 0.5)                # treatment
M <- 1.2 * X + rnorm(n)               # mediator
Y <- 0.5 * X + 2 * M + rnorm(n)       # outcome influenced by both

df <- data.frame(X, M, Y)
```

---

## 2. 🧮 Fit Models for Mediation Analysis

```{r}
# Mediator model
model_M <- lm(M ~ X, data = df)

# Outcome model including mediator
model_Y <- lm(Y ~ X + M, data = df)
```

---

## 3. 🔍 Estimate Mediation Effects

```{r}
med <- mediate(model_M, model_Y, treat = "X", mediator = "M", boot = TRUE, sims = 500)
summary(med)
```

---

## 4. 📊 Visualize Mediation Summary

```{r}
plot(med)
```

---

## ✅ Interpretation

- **ACME**: Average causal mediation effect (indirect effect)
- **ADE**: Average direct effect
- **Total Effect**: ACME + ADE
- **Proportion Mediated**: Fraction of total effect due to mediation

---

## 📖 References

- Imai, Keele, Tingley (2010). *A general approach to causal mediation analysis*
- Pearl (2001). *Direct and indirect effects*